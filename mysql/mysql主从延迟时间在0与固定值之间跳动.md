| operator | createtime | updatetime |
| ---- | ---- | ---- |
| shenx | 2023-9月-21 | 2023-9月-21  |
| ... | ... | ... |
---
# mysql主从延迟时间在0与固定值之间跳动

[toc]

**【问题背景】**
  2.0生产环境主从延迟一直发生，发现主从库系统时间戳不一致。

**【问题发现】**
> - 23-09-20 16:30 发现2.0主从再一次发生延迟
> - 23-09-20 18:00 配置好主从的ntp时间同步，发现主从一致报延迟，延迟时间一直在0和一个固定数字之间跳
![主从延迟监控](\\image\\20230921163941.png )

**【影响范围】**
 事实上的主从延迟并不高，只是Seconds_Behind_Master取值不正常。

**【解决过程】**
> - 19:00 定位到Seconds_Behind_Master的变化很有规律，但是事实上的主从延迟并没有那么大。
> - 21:00 事实上的延迟并不高，考虑直接通过放大主从延迟的告警阈值来暂时处理。
> - 09-21 10:00 将从库的slave 重启，问题解决。

**【原因分析】**
是mysql主从建立时会记录主从服务器的时间戳的差值，并在计算主从延迟时配平，但是在启动复制以后，主从节点间的时间差发生改变，之前计算的差值并不会改变，而是依然会加到Seconds_Behind_Master上去，导致这个问题

**【避免办法】**
在修改以后主从服务器的时候以后立即重启slave。
